#!/usr/bin/env python3
import sys
import os
import asyncio

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å Python
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from app.services.embedding import embedding_service
from sentence_transformers import SentenceTransformer
import numpy as np

def debug_embeddings():
    print("üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤...")
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞–ø—Ä—è–º—É—é –º–æ–¥–µ–ª—å
    print("1. –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å –Ω–∞–ø—Ä—è–º—É—é:")
    model = SentenceTransformer('sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2')
    
    test_texts = ["—Ç–µ—Å—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç", "–≤—Ç–æ—Ä–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç"]
    embeddings = model.encode(test_texts)
    
    print(f"   –¢–∏–ø embeddings: {type(embeddings)}")
    print(f"   –§–æ—Ä–º–∞ embeddings: {embeddings.shape}")
    print(f"   –¢–∏–ø –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞: {type(embeddings[0])}")
    print(f"   –§–æ—Ä–º–∞ –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞: {embeddings[0].shape if hasattr(embeddings[0], 'shape') else 'N/A'}")
    print(f"   –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: {len(embeddings[0])}")
    print(f"   –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏–π: {embeddings[0][:5]}")
    
    print("\n2. –¢–µ—Å—Ç–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å:")
    service_embeddings = embedding_service.encode(test_texts)
    print(f"   –¢–∏–ø: {type(service_embeddings)}")
    print(f"   –§–æ—Ä–º–∞: {service_embeddings.shape if hasattr(service_embeddings, 'shape') else 'N/A'}")
    
    if len(service_embeddings) > 0:
        first = service_embeddings[0]
        print(f"   –¢–∏–ø –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞: {type(first)}")
        if hasattr(first, '__len__'):
            print(f"   –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞: {len(first)}")
        else:
            print(f"   –ü–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–µ–∫—Ç–æ—Ä–æ–º: {first}")

if __name__ == "__main__":
    debug_embeddings()
